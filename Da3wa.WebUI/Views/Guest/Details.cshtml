@model Da3wa.Domain.Entities.Guest

@{
    Layout = "_AdminLayout";
    ViewData["Title"] = "Guest Details";
}

<!-- Page Header -->
<div class="row mb-4">
    <div class="col-12">
        <div class="d-flex justify-content-between align-items-center">
            <div>
                <h4 class="mb-0">Guest Details</h4>
                <p class="text-muted mb-0">View complete guest information</p>
            </div>
            <div>
                <a asp-action="Edit" asp-route-id="@Model.Id" class="btn btn-outline-primary me-2">
                    <i class="fas fa-edit me-2"></i>Edit
                </a>
                <a asp-action="Index" class="btn btn-outline-secondary">
                    <i class="fas fa-arrow-left me-2"></i>Back to List
                </a>
            </div>
        </div>
    </div>
</div>

<!-- Guest Information Cards -->
<div class="row">
    <!-- Main Information Card -->
    <div class="col-lg-8 mb-4">
        <div class="admin-card">
            <div class="card-header">
                <h5 class="card-title mb-0">
                    <i class="fas fa-user me-2"></i>Personal Information
                </h5>
            </div>
            <div class="card-body">
                <div class="row mb-3">
                    <div class="col-md-6">
                        <label class="text-muted small mb-1">Full Name</label>
                        <h6 class="mb-0">@Model.FullName</h6>
                    </div>
                    <div class="col-md-6">
                        <label class="text-muted small mb-1">Event</label>
                        <h6 class="mb-0">
                            @if (Model.Event != null)
                            {
                                <span class="badge bg-primary">@Model.Event.Name</span>
                            }
                            else
                            {
                                <span class="text-muted">No Event Assigned</span>
                            }
                        </h6>
                    </div>
                </div>

                <div class="row mb-3">
                    <div class="col-md-6">
                        <label class="text-muted small mb-1">Family Members</label>
                        <h6 class="mb-0">
                            <i class="fas fa-users me-2 text-primary"></i>@Model.FamilyNumber Person(s)
                        </h6>
                    </div>
                    <div class="col-md-6">
                        <label class="text-muted small mb-1">Attendance Status</label>
                        <h6 class="mb-0">
                            @if (Model.IsAttending)
                            {
                                <span class="badge bg-success">
                                    <i class="fas fa-check me-1"></i>Attending
                                </span>
                            }
                            else
                            {
                                <span class="badge bg-warning">
                                    <i class="fas fa-times me-1"></i>Not Attending
                                </span>
                            }
                        </h6>
                    </div>
                </div>

                <div class="row">
                    <div class="col-12">
                        <label class="text-muted small mb-2">Phone Numbers</label>
                        @if (Model.Tel != null && Model.Tel.Any())
                        {
                            <div class="d-flex flex-wrap gap-2">
                                @foreach (var tel in Model.Tel)
                                {
                                    <div class="badge bg-light text-dark border p-2">
                                        <i class="fas fa-phone text-primary me-2"></i>
                                        <a href="tel:@tel" class="text-decoration-none text-dark">@tel</a>
                                    </div>
                                }
                            </div>
                        }
                        else
                        {
                            <p class="text-muted mb-0">
                                <i class="fas fa-exclamation-circle me-2"></i>No phone numbers available
                            </p>
                        }
                    </div>
                </div>
            </div>
        </div>

        <!-- QR Code Information -->
        @if (!string.IsNullOrEmpty(Model.QrToken))
        {
            <div class="admin-card mt-4">
                <div class="card-header">
                    <h5 class="card-title mb-0">
                        <i class="fas fa-qrcode me-2"></i>QR Code Information
                    </h5>
                </div>
                <div class="card-body">
                    <div class="row align-items-center">
                        <div class="col-md-8">
                            <label class="text-muted small mb-1">QR Token</label>
                            <div class="input-group">
                                <input type="text" class="form-control" value="@Model.QrToken" readonly id="qrTokenInput">
                                <button class="btn btn-outline-secondary" type="button" onclick="copyQrToken()">
                                    <i class="fas fa-copy"></i>
                                </button>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <label class="text-muted small mb-1">Expires On</label>
                            <p class="mb-0">
                                <i class="fas fa-calendar-times me-2 text-danger"></i>
                                @Model.ExpireAt.ToString("MMM dd, yyyy")
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        }

        @if (!string.IsNullOrEmpty(Model.InvitationImagePath))
        {
            <div class="admin-card mt-4">
                <div class="card-header">
                    <h5 class="card-title mb-0">
                        <i class="fas fa-id-card me-2"></i>Generated Invitation
                    </h5>
                </div>
                <div class="card-body text-center">
                    <img src="@Model.InvitationImagePath" alt="Invitation" class="img-fluid rounded border" style="max-height: 500px;">
                </div>
            </div>
        }
    </div>

    <!-- Sidebar Information -->
    <div class="col-lg-4 mb-4">
        <!-- Status Card -->
        <div class="admin-card mb-4">
            <div class="card-header">
                <h5 class="card-title mb-0">
                    <i class="fas fa-info-circle me-2"></i>Status
                </h5>
            </div>
            <div class="card-body">
                <div class="mb-3">
                    <label class="text-muted small mb-1">Account Status</label>
                    <div>
                        @if (Model.IsDeleted)
                        {
                            <span class="badge bg-danger fs-6">
                                <i class="fas fa-ban me-1"></i>Deleted
                            </span>
                        }
                        else
                        {
                            <span class="badge bg-success fs-6">
                                <i class="fas fa-check-circle me-1"></i>Active
                            </span>
                        }
                    </div>
                </div>

                @if (!string.IsNullOrEmpty(Model.QrToken))
                {
                    <div class="mb-3">
                        <label class="text-muted small mb-1">QR Status</label>
                        <div>
                            @if (Model.ExpireAt > DateTime.Now)
                            {
                                <span class="badge bg-success fs-6">
                                    <i class="fas fa-check me-1"></i>Valid
                                </span>
                            }
                            else
                            {
                                <span class="badge bg-danger fs-6">
                                    <i class="fas fa-times me-1"></i>Expired
                                </span>
                            }
                        </div>
                    </div>
                }

                <div>
                    <label class="text-muted small mb-1">Time Until Expiration</label>
                    <p class="mb-0">
                        @{
                            var timeUntilExpire = Model.ExpireAt - DateTime.Now;
                            if (timeUntilExpire.TotalDays > 0)
                            {
                                <span class="text-success">
                                    <i class="fas fa-clock me-1"></i>@((int)timeUntilExpire.TotalDays) day(s)
                                </span>
                            }
                            else
                            {
                                <span class="text-danger">
                                    <i class="fas fa-exclamation-triangle me-1"></i>Expired
                                </span>
                            }
                        }
                    </p>
                </div>
            </div>
        </div>

        <!-- Timestamps Card -->
        <div class="admin-card">
            <div class="card-header">
                <h5 class="card-title mb-0">
                    <i class="fas fa-history me-2"></i>Timestamps
                </h5>
            </div>
            <div class="card-body">
                <div class="mb-3">
                    <label class="text-muted small mb-1">Created On</label>
                    <p class="mb-0">
                        <i class="fas fa-calendar-plus me-2 text-success"></i>
                        @Model.CreatedOn.ToString("MMM dd, yyyy")
                        <br>
                        <small class="text-muted ms-4">@Model.CreatedOn.ToString("hh:mm tt")</small>
                    </p>
                </div>

                @if (Model.LastUpdatedOn.HasValue)
                {
                    <div>
                        <label class="text-muted small mb-1">Last Updated</label>
                        <p class="mb-0">
                            <i class="fas fa-calendar-edit me-2 text-primary"></i>
                            @Model.LastUpdatedOn.Value.ToString("MMM dd, yyyy")
                            <br>
                            <small class="text-muted ms-4">@Model.LastUpdatedOn.Value.ToString("hh:mm tt")</small>
                        </p>
                    </div>
                }

                <div class="mt-3">
                    <label class="text-muted small mb-1">Expires At</label>
                    <p class="mb-0">
                        <i class="fas fa-calendar-times me-2 text-danger"></i>
                        @Model.ExpireAt.ToString("MMM dd, yyyy")
                        <br>
                        <small class="text-muted ms-4">@Model.ExpireAt.ToString("hh:mm tt")</small>
                    </p>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        function copyQrToken() {
            var copyText = document.getElementById("qrTokenInput");
            copyText.select();
            copyText.setSelectionRange(0, 99999);
            navigator.clipboard.writeText(copyText.value);

            // Show feedback
            var btn = event.target.closest('button');
            var originalHtml = btn.innerHTML;
            btn.innerHTML = '<i class="fas fa-check"></i>';
            btn.classList.remove('btn-outline-secondary');
            btn.classList.add('btn-success');

            setTimeout(function() {
                btn.innerHTML = originalHtml;
                btn.classList.remove('btn-success');
                btn.classList.add('btn-outline-secondary');
            }, 2000);
        }
    </script>
}
